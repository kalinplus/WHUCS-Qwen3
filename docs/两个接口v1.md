## **AI 功能接口文档**

API_KEY: super_plus_api_key

### **1. AI 智能搜索总结接口**

该接口用于单轮的、无上下文记忆的智能搜索。用户提供一个查询问题，后端通过 RAG（检索增强生成）技术，从知识库中查找相关资料，并结合大语言模型生成结构化的总结性回答。

- **Endpoint**: `/api/v1/smart-search`
- **Method**: `POST`
- **Summary**: AI 智能搜素总结接口
- **Authentication**: 请求头中必须包含 API Key。
  - **Header**: `X-API-Key: super_plus_api_key`

#### **Request Body**

```json
{
  "query": "string"
}
```

- **`query`** (string, required): 用户的搜索查询内容。不能为空字符串。

#### **Success Response (200 OK)**

```json
{
  "answer": "string",
  "source": [
    {
      "id": "string",
      "content": "string",
      "metadata": {
        "source": "string",
        "page": "integer"
      }
    }
  ]
}
```

- **`answer`** (string): 由 AI 模型生成的、经过 Markdown 格式化的结构化回答。
- **`source`** (array of objects): 用于生成回答的溯源文档片段列表。
  - **`id`** (string): 文档片段的唯一 ID。
  - **`content`** (string): 文档片段的具体文本内容。
  - **`metadata`** (object): 文档的元数据。
    - **`source`** (string): 原始文档的文件名或来源标识。
    - **`page`** (integer): 该片段在原始文档中的页码。

#### **Error Responses**

- **`400 Bad Request`**: 请求体不合法（例如，`query` 字段缺失或为空）。
  ```json
  { "detail": "没有收到查询内容" }
  ```
- **`401 Unauthorized`**: API Key 无效或未提供。
  ```json
  { "detail": "未提供 API Key" }
  ```
- **`500 Internal Server Error`**: 服务器内部发生未知错误。
  ```json
  { "detail": "处理请求时发生内部错误: [错误信息]" }
  ```
- **`503 Service Unavailable`**: 后端的 AI 推理服务不可用。
  ```json
  { "detail": "无法连接到离线推理服务: [错误信息]" }
  ```

#### **示例**

**Request:**

```bash
curl -X POST "http://your-api-server/smart-search" \
-H "Content-Type: application/json" \
-H "X-API-Key: YOUR_API_KEY" \
-d '{
  "query": "如何创建一个新的社团？"
}'
```

**Response (200 OK):**

```json
{
  "answer": "### **核心摘要**\n要创建一个新的社团，您需要先提交一份包含社团基本信息的申请表，并通过管理员的审核。\n\n### **关键信息/步骤**\n1.  **登录系统**：使用您的学号和密码登录社团管理系统。\n2.  **进入申请页面**：在导航栏找到“社团管理”，点击“创建社团”。\n3.  **填写申请表**：按要求填写社团名称、简介、负责人信息等。\n4.  **提交审核**：确认信息无误后，点击提交，等待管理员审核。\n\n### **实用技巧/补充**\n- 建议在申请前准备好详细的社团章程和活动计划，这会加快审核过程。\n- 您可以在“我的申请”页面随时查看审核进度。",
  "source": [
    {
      "id": "doc1_chunk3",
      "content": "社团创建流程：用户需在系统中填写并提交《社团成立申请表》。管理员将在后台收到申请并进行审核，审核结果将通过系统消息通知申请人...",
      "metadata": {
        "source": "社团管理手册.pdf",
        "page": 5
      }
    }
  ]
}
```

---

### **2. RAG 侧边栏对话接口**

该接口用于支持多轮、有上下文记忆的连续对话。它会结合历史对话记录和当前问题的 RAG 检索结果，生成更具相关性和连贯性的回答。

- **Endpoint**: `/api/v1/sider-chat`
- **Method**: `POST`
- **Summary**: RAG 侧边栏对话接口
- **Authentication**: 请求头中必须包含 API Key。
  - **Header**: `X-API-Key: super_plus_api_key`

#### **Request Body**

```json
{
  "query": "string",
  "history": [
    {
      "role": "string",
      "content": "string"
    }
  ]
}
```

- **`query`** (string, required): 用户当前轮次的提问。
- **`history`** (array of objects, optional): 历史对话记录列表。
  - **`role`** (string, required): 消息发送者的角色，必须是 `user` 或 `assistant`。
  - **`content`** (string, required): 消息的具体内容。

#### **Success Response (200 OK)**

```json
{
  "answer": "string",
  "source": [
    {
      "id": "string",
      "content": "string",
      "metadata": {
        "source": "string",
        "page": "integer"
      }
    }
  ]
}
```

- **`answer`** (string): AI 模型结合上下文生成的 Markdown 格式回答。
- **`source`** (array of objects): **仅为当前问题**检索到的溯源文档片段列表。

#### **Error Responses**

与 `/smart-search` 接口的错误响应类型和结构基本一致。

#### **示例**

**Request:**

```bash
curl -X POST "http://your-api-server/sider-chat" \
-H "Content-Type: application/json" \
-H "X-API-Key: YOUR_API_KEY" \
-d '{
  "query": "审核一般需要多久？",
  "history": [
    {
      "role": "user",
      "content": "如何创建一个新的社团？"
    },
    {
      "role": "assistant",
      "content": "### **核心摘要**\n要创建一个新的社团，您需要先提交一份包含社团基本信息的申请表，并通过管理员的审核。\n\n### **关键信息/步骤**\n1.  **登录系统**：使用您的学号和密码登录社团管理系统。\n2.  **进入申请页面**：在导航栏找到“社团管理”，点击“创建社团”。\n3.  **填写申请表**：按要求填写社团名称、简介、负责人信息等。\n4.  **提交审核**：确认信息无误后，点击提交，等待管理员审核。\n\n### **实用技巧/补充**\n- 建议在申请前准备好详细的社团章程和活动计划，这会加快审核过程。\n- 您可以在“我的申请”页面随时查看审核进度。"
    }
  ]
}'
```

**Response (200 OK):**

```json
{
  "answer": "### **核心摘要**\n社团创建的审核过程通常需要3到5个工作日。\n\n### **关键信息/步骤**\n1.  **自动流转**：您提交申请后，系统会自动将申请流转至对应的管理部门。\n2.  **人工审核**：相关负责老师会在此期间对您提交的材料进行人工审核。\n3.  **结果通知**：审核完成后，无论通过与否，系统都会通过站内信和邮件通知您。\n\n### **实用技巧/补充**\n- 如果超过5个工作日仍未收到通知，建议您通过系统的申诉渠道联系管理员进行咨询。",
  "source": [
    {
      "id": "doc1_chunk4",
      "content": "关于审核时效的说明：所有社团成立申请，将在提交后的3-5个工作日内完成审批流程。特殊情况除外。",
      "metadata": {
        "source": "社团管理手册.pdf",
        "page": 6
      }
    }
  ]
}
```
